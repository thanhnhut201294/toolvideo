<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>TikTok Video Info Tool</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: #f7f8fa;
      margin: 0;
      padding: 40px;
      color: #333;
    }
    h1 {
      text-align: center;
      color: #111;
    }
    .container {
      max-width: 700px;
      margin: 0 auto;
      background: #fff;
      padding: 25px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      margin-bottom: 15px;
      font-size: 15px;
    }
    button {
      padding: 10px 16px;
      border: none;
      background: #0078ff;
      color: white;
      border-radius: 8px;
      cursor: pointer;
      font-size: 15px;
      transition: 0.2s;
    }
    button:hover { background: #005ecc; }
    #result {
      margin-top: 20px;
      padding: 15px;
      border-radius: 12px;
      background: #f9fafc;
      border: 1px solid #eee;
    }
    img {
      border-radius: 10px;
      margin-top: 10px;
    }
    .download-btns {
      margin-top: 15px;
    }
    .download-btns button {
      margin-right: 10px;
      background: #2ecc71;
    }
    .download-btns button:last-child {
      background: #f1c40f;
    }
  </style>
</head>
<body>
  <h1>üìπ TikTok Info Extractor</h1>
  <div class="container">
    <input id="tiktokUrl" placeholder="D√°n link TikTok v√†o ƒë√¢y..." />
    <button id="getData">L·∫•y d·ªØ li·ªáu</button>

    <div id="result"></div>
    <div class="download-btns" style="display:none;">
      <button id="downloadCsv">‚¨áÔ∏è T·∫£i CSV</button>
      <button id="downloadXlsx">‚¨áÔ∏è T·∫£i XLSX</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script>
    let currentData = null;

    document.getElementById("getData").addEventListener("click", async () => {
      const url = document.getElementById("tiktokUrl").value.trim();
      const apiUrl = `https://tikwmcom.thanhnhut201294.workers.dev/?url=${encodeURIComponent(url)}`;
      const resultDiv = document.getElementById("result");
      const btnGroup = document.querySelector(".download-btns");

      resultDiv.innerHTML = "‚è≥ ƒêang t·∫£i d·ªØ li·ªáu...";
      btnGroup.style.display = "none";

      try {
        const res = await fetch(apiUrl);
        const data = await res.json();

        if (data.error) {
          resultDiv.innerHTML = `<p style="color:red">${data.error}</p>`;
          return;
        }

        currentData = data;

        resultDiv.innerHTML = `
          <h3>${data.title || "(Kh√¥ng c√≥ ti√™u ƒë·ªÅ)"}</h3>
          <img src="${data.cover}" width="200"><br>
          <p><b>L∆∞·ª£t xem:</b> ${data.stats.play.toLocaleString()}</p>
          <p><b>Tim:</b> ${data.stats.like.toLocaleString()}</p>
          <p><b>B√¨nh lu·∫≠n:</b> ${data.stats.comment.toLocaleString()}</p>
          <p><b>Chia s·∫ª:</b> ${data.stats.share.toLocaleString()}</p>
          <p><b>L∆∞u:</b> ${data.stats.save.toLocaleString()}</p>
          <p><b>Caption:</b> ${data.caption}</p>
          <a href="${data.playUrl}" target="_blank">üîó M·ªü / T·∫£i video</a>
        `;
        btnGroup.style.display = "block";
      } catch (err) {
        resultDiv.innerHTML = `<p style="color:red">L·ªói k·∫øt n·ªëi: ${err.message}</p>`;
      }
    });

    // üì• T·∫£i CSV
    document.getElementById("downloadCsv").addEventListener("click", () => {
      if (!currentData) return alert("Ch∆∞a c√≥ d·ªØ li·ªáu ƒë·ªÉ t·∫£i!");
      const csv = [
        ["ID", "Ti√™u ƒë·ªÅ", "L∆∞·ª£t xem", "Tim", "B√¨nh lu·∫≠n", "Chia s·∫ª", "L∆∞u", "Caption", "Link Video"],
        [
          currentData.id,
          `"${currentData.title}"`,
          currentData.stats.play,
          currentData.stats.like,
          currentData.stats.comment,
          currentData.stats.share,
          currentData.stats.save,
          `"${currentData.caption}"`,
          currentData.playUrl
        ]
      ].map(r => r.join(",")).join("\n");

      const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "tiktok_video.csv";
      a.click();
    });

    // üìä T·∫£i XLSX
    document.getElementById("downloadXlsx").addEventListener("click", () => {
      if (!currentData) return alert("Ch∆∞a c√≥ d·ªØ li·ªáu ƒë·ªÉ t·∫£i!");
      const ws = XLSX.utils.json_to_sheet([{
        ID: currentData.id,
        Ti√™u_ƒë·ªÅ: currentData.title,
        L∆∞·ª£t_xem: currentData.stats.play,
        Tim: currentData.stats.like,
        B√¨nh_lu·∫≠n: currentData.stats.comment,
        Chia_s·∫ª: currentData.stats.share,
        L∆∞u: currentData.stats.save,
        Caption: currentData.caption,
        Link_Video: currentData.playUrl
      }]);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "TikTok");
      XLSX.writeFile(wb, "tiktok_video.xlsx");
    });
  </script>
</body>
</html>
